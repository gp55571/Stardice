<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyniki wyszukiwania - FilmWyszukaj</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

<div class="main-wrapper">

<header class="top-header">
    <div class="logo-container">
        <a href="index.html">
            <img class="logo" src="logo.png" alt="logo">
        </a>
        <span class="logo-text"><a href="index.html">FilmWyszukaj</a></span>
    </div>

    <div class="search-bar-container">
        <span class="material-icons search-icon">search</span>
        <input type="text" class="search-input" id="main-search">
        <span class="material-icons close-icon">close</span>
    </div>

    <div class="menu-dots">
        <span class="material-icons">more_vert</span>
    </div>
</header>

<main class="content-area">

<section class="search-title-section">
    <h1>Wynik wyszukiwania:
        <span id="dynamic-query" class="highlight-blue">...</span>
    </h1>
    <div class="search-underline"></div>
</section>

<div class="filters-container" id="filters-list">
    <button class="btn-add-filter" id="add-filter-btn">
        <span class="plus">+</span> dodaj filtr
    </button>
</div>

<div id="filter-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Wybierz filtr</h3>
        <div class="filter-options">
            <button class="opt-btn" data-type="Rok">Rok produkcji</button>
            <button class="opt-btn" data-type="Gatunek">Gatunek</button>
            <button class="opt-btn" data-type="Ocena">Minimalna ocena</button>
        </div>
        <button id="close-modal" class="btn-secondary">Anuluj</button>
    </div>
</div>

<div class="results-list" id="results-list">
</div>

</main>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const movieId = params.get('id');


const modal = document.getElementById('filter-modal');
const addBtn = document.getElementById('add-filter-btn');
const closeBtn = document.getElementById('close-modal');
const filtersList = document.getElementById('filters-list');

addBtn.onclick = () => modal.style.display = 'flex';
closeBtn.onclick = () => modal.style.display = 'none';

document.querySelectorAll('.opt-btn').forEach(btn => {
    btn.onclick = () => {
        const tag = document.createElement('div');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            ${btn.dataset.type}
            <span class="material-icons close-tag">close</span>
        `;
        tag.querySelector('.close-tag').onclick = e => {
            e.stopPropagation();
            tag.remove();
        };
        filtersList.appendChild(tag);
        modal.style.display = 'none';
    };
});


fetch('filmy.json')
.then(res => res.json())
.then(data => {

    const moviesTable = data.objects.find(o => o.name === 'movies');

    const movies = moviesTable.rows.map(r => ({
        id: r[0],
        title: r[1],
        year: r[2],
        runtime: r[3],
        imdb: r[4],
        description: r[5]
    }));

    const results = movieId
        ? movies.filter(m => m.id == movieId)
        : movies;

    const container = document.getElementById('results-list');
    container.innerHTML = '';

    if (!results.length) {
        container.innerHTML = '<p>Brak wynik√≥w</p>';
        return;
    }

    results.forEach(movie => {
        const card = document.createElement('article');
        card.className = 'result-card';
        card.innerHTML = `
            <div class="card-poster-area"></div>
            <div class="card-info-area">
                <div class="card-header-row">
                    <h2 class="movie-name">${movie.title}</h2>
                    <div class="movie-score">
                        <span class="material-icons">star_border</span>
                        ${movie.imdb}
                    </div>
                </div>
                <p class="movie-description">${movie.description}</p>
                <div class="card-footer-row">
                    <span class="meta-info">${movie.year}</span>
                </div>
            </div>
        `;

        card.onclick = () => {
            window.location.href = `film.html?id=${movie.id}`;
        };

        container.appendChild(card);
    });

    document.getElementById('dynamic-query').innerText =
        results.length === 1 ? results[0].title : 'wszystkie filmy';
});
</script>

</body>
</html>
